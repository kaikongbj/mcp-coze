# Coze MCP 服务器使用说明（Trae版）

## 🎯 功能概述

本MCP服务器提供两个核心功能：
- **上传文件到知识库**：支持PDF、docx、xlsx、pptx、md、txt格式，单个文件≤100MB
- **与机器人聊天**：基于已创建的机器人进行对话交互

## 📋 使用前的准备

### 第1步：获取API信息

#### 1.1 获取个人访问令牌（必填）

1. 访问 [Coze官网](https://www.coze.cn) 并登录账号
2. 点击页面左下角的 **"扣子API"**
3. 选择 **"API令牌"** → **"添加新令牌"**
4. 填写信息：
   - **令牌名称**：任意填写（如：trae-mcp）
   - **过期时间**：根据需要选择
   - **访问团队空间**：选择要访问的空间
   - **权限**：勾选所需权限（建议全选）
5. 点击 **"生成令牌"**，**立即复制并保存**（令牌只显示一次）

#### 1.2 获取空间ID（必填）

**方法1：通过URL获取（推荐）**
1. 登录 [Coze开发平台](https://www.coze.cn/home)
2. 查看浏览器地址栏，格式为：`https://www.coze.cn/home?workspace={空间ID}`
3. 复制`workspace=`后面的数字，这就是你的空间ID

**方法2：通过页面获取**
1. 登录 [Coze开发平台](https://www.coze.cn/home)
2. 点击左侧菜单 **"工作空间"**
3. 在页面右上角点击当前空间名称
4. 在下拉菜单中选择 **"空间设置"**
5. 在设置页面中找到 **"空间ID"**，复制该数字

### 第2步：创建知识库（重要！）

⚠️ **注意：不能通过Trae创建知识库，必须在Coze平台手动创建**

1. 登录 [Coze开发平台](https://www.coze.cn/home)
2. 进入你的工作空间
3. 点击 **"知识库"** → **"创建知识库"**
4. 填写信息：
   - **名称**：任意填写（如：项目文档）
   - **描述**：可选填写
   - **权限**：选择"私有"或"公开"
5. 点击 **"创建"**，记住创建的知识库名称

### 第3步：Trae MCP配置

1. 打开Trae编辑器
2. 进入 **设置** → **MCP** → **添加MCP服务器**
3. 填写配置：
{
  "mcpServers": {
    "coze": {
      "command": "D:/mcp-coze/target/debug/coze-mcp-server.exe",
      "args": [
        "--api-key",
        "pat_8NU7DXjMPg4O7rg4tbt8ZYzKkHRIMTZ8SKANbdYdjf0vMPKR7CbKsn0biE9TKcDi",
        "--space-id",
        "7409828301432356875"
      ]
    }
  }
}
     ```

## 🚀 功能使用

### 📁 上传文件到知识库

**支持格式**：PDF、docx、xlsx、pptx、md、txt
**大小限制**：单个文件≤100MB

**操作步骤**：
1. 在Trae中与AI对话：
   ```
   我：请将这个文件上传到知识库"项目文档"
   [选择文件]
   ```
2. AI会自动调用MCP服务器上传文件
3. 等待上传完成提示

**示例对话**：
```
用户：请上传这个PDF文档到我的"项目文档"知识库
AI：我来帮您上传文件到知识库"项目文档"
[文件上传中...]
✅ 文件上传成功！已添加到知识库"项目文档"
```

### 💬 与机器人聊天

**前提条件**：已在Coze平台创建并发布机器人

**操作步骤**：
1. 在Trae中与AI对话：
   ```
   我：请与机器人"我的助手"对话：你好，介绍一下你自己
   ```
2. AI会自动调用MCP服务器与指定机器人对话
3. 获取机器人的回复

**示例对话**：
```
用户：请让机器人"客服助手"回答：你们提供什么服务？
AI：我来帮您与机器人"客服助手"对话
机器人回复：我们提供24小时在线客服支持，包括产品咨询、技术支持和售后服务。
```

## 🔍 故障排除

### ❌ 找不到知识库
**原因**：知识库未在Coze平台创建
**解决**：
1. 登录 [Coze开发平台](https://www.coze.cn/home)
2. 进入 **知识库** 页面确认知识库是否存在
3. 如不存在，点击 **"创建知识库"** 手动创建

### ❌ 令牌无效
**原因**：API令牌错误或已过期
**解决**：
1. 检查Trae MCP配置中的`COZE_API_KEY`是否正确
2. 重新生成新的API令牌
3. 更新Trae中的环境变量配置

### ❌ 空间ID错误
**原因**：空间ID格式错误或无权访问
**解决**：
1. 确认空间ID为纯数字格式
2. 检查是否有该空间的访问权限
3. 重新按照第1步获取正确的空间ID

## ⚡ 快速操作清单

| 操作 | 对话示例 |
|------|----------|
| 查看知识库列表 | "请列出我的所有知识库" |
| 上传文件 | "请将[文件]上传到知识库[名称]" |
| 与机器人对话 | "请让机器人[名称]回答：[问题]" |
| 查看机器人列表 | "请列出我的所有机器人" |

## 📞 技术支持

如遇到问题，请按以下顺序检查：
1. ✅ 确认已在Coze平台创建知识库
2. ✅ 确认API令牌有效且有访问权限
3. ✅ 确认空间ID正确
4. ✅ 确认Trae MCP配置无误
